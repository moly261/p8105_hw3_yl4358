---
title: "p8105_hw3_yl4358"
author: "YI LIU"
date: "10/6/2019"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

Problem 1
```{r}
library(p8105.datasets)
data("instacart")
```

* The `instacart` dataset contains `r nrow(instacart)` rows and `r ncol(instacart)` columns; Key variables include `user_id`, `product_name`, `order_number`, `order_dow`, `order_hour_of_day` and so on. Every observation illustrates the product name, its order time, user's relevant ordering information, its belonging aisle and department.

```{r}
instacart_1 =
  instacart %>%
  group_by(aisle) %>% 
  summarize(n = n()) %>% 
  arrange(desc(n))

head(instacart_1,10) %>% 
knitr::kable()
```

* There are `r nrow(instacart_1)` aisles there and `fresh vegetables` and `fresh fruits` aisles are the most items ordered from.

```{r}
knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%"
)
instacart_2 =
  instacart %>%
  group_by(aisle_id) %>% 
  summarize(n = n()) %>%
  arrange(desc(n)) %>% 
  filter(n >= 10000) %>% 
   ggplot(aes(x = aisle_id, y = n)) + 
    geom_point(color = "blue", size = 3) + geom_line(color = "blue") +
  labs(
    title = "The number of items ordered in each aisle",
    x = "Aisle ID",
    y = "The number of items ordered"
  ) +
  theme_bw()
instacart_2
```

* We use point and line plot to display the number of items ordered in each aisle, they are quite different among aisles. As we can see, aisle 24 (fresh fruits) and aisle 83 (fresh vegetables) are aisles most items ordered from. Plot is so clear and straightforward that we could get information from it.

```{r}
instacart_3 =
  instacart %>% 
  filter(aisle == "baking ingredients" | aisle == "dog food care" | aisle == "packaged vegetables fruits") %>% 
  group_by(aisle, product_name) %>% 
  summarize(n = n()) %>% 
  filter(min_rank(desc(n)) == 1) %>% 
  rename(most_popular_items = product_name, ordering_counts = n) %>% 
  knitr::kable()
instacart_3
```

* Concluded from the table, most popular items in `baking ingredient`, `dog food care` and `packaged vegetables fruits` aisle are respectively `light brown sugar`, `snack sticks chicken & rice recipe dog treats` and `organic baby spinach`.

```{r}
instacart_4 = 
  instacart %>% 
  filter(product_name == "Pink Lady Apples" | product_name == "Coffee Ice Cream") %>% 
  group_by(product_name, order_dow) %>% 
  summarize(
    mean_hour_of_the_day = round(mean(order_hour_of_day), digits = 1)
  ) %>% 
  pivot_wider(
    names_from = "order_dow",
    values_from = "mean_hour_of_the_day"
  ) %>%
  rename( Monday = '0', Tuesday = '1', Wednesday = '2', Thursday = '3', Friday = '4', Saturday = '5', Sunday = '6') %>% 
  knitr::kable()

instacart_4
```

* People are more likely to order `Coffee Ice Cream` during 12:00pm-15:00pm which is teatime and order `Pink Lady Apples` during 11:00am to 14:00 pm when having lunch.
